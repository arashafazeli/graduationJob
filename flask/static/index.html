<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Database search</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link href="static/css/style.css" type="text/css" rel="stylesheet">
  </head>
  <body onload="view(0)">
    <nav class="navbar navbar-dark navbar-expand bg-dark px-5">
      <!-- Links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="navbar-brand" style="cursor:pointer" onclick="location.reload()">Webshop</a>
        </li>
      </ul>
      <div class="form-inline px-4" style="width: 45%">
        <input type="text" class="form-control" placeholder="Search after products..." oninput="search(this.value)" id="inpSearch">
      </div>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#">Cart</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="static/admin.html">Admin <login></login></a>
        </li>
      </ul>
    </nav>
    <table class="resultData table-responsive" id="resultData"></table>

    <div class="wrapper">
      <select class="form-control" onchange="orderProducts()" id="selectOrder">
        <option>Order by price (low - high)</option>
        <option>Order by price (high - low)</option>
        <option>Order by name</option>
      </select>
      <table class="table" id="tblProducts">
      </table>
      <div id="product" style="display: none">
      </div>
    </div>

    <script>
    function orderProducts() {
      const index = document.getElementById("selectOrder").selectedIndex;
      view(index);
    }

    // show all products
    function view(order) {

      $.get("/api/product/get", {order: order}, function(data) {
        console.log(data);

        $("#tblProducts").html(`<h4>Displaying ${data.length} products.</h4>`);
        for (var i = 0; i < data.length; i++) {
          const product = data[i];

          if((i % 5) === 0) {
            $("#tblProducts").append("</tr><tr>");
          }

          $("#tblProducts").append(`<td onclick="showProduct(${product[0]})" class="product"><img src='${product[4]}' class='listImg'><br>
                                      <h4>${product[1]}</h4>${product[3]} kr<br></td>`);
        }
      })
    }

    // show specific product
    function showProduct(id) {
      $("#resultData").css("display","none");
      $("#tblProducts").css("display","none");
      $("#selectOrder").css("opacity","0");
      $("#selectOrder").css("pointer-events","none");
      $("#product").css("display","block");

      $.get("/api/product/get/"+id, {}, function(data) {
        console.log(data);
        console.log("Name: " + data[0][1] + " Desc: " + data[0][2])
         $("#product").html(`<h1>${data[0][1]}</h1>
                             <h3>${data[0][3]} kr</h3>
                             <table id="producttbl">
                                <td>
                                    <img style="width: 25em; height: 25em" src='${data[0][4]}'>
                                </td>
                                <td>
                                    <h5>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean dignissim finibus pharetra. Etiam tempor elementum lacus ut lacinia. Suspendisse tristique mi mauris,  </h5>
                                    <button style="font-size: 1.5em">Add to cart</button>
                                </td>
                             </table>`);
      })
    }

    // search products
    function search(val) {

      if (val != "" && val != " ") {
        $("#resultData").css("display","block");

        $.get("/api/product/search", {keyword: val}, function(data) {
          // search db
          console.log(data);

          if (data.length > 0) { // match
            $("#resultData").html("");
            for (var i = 0; i < data.length; i++) {
                $("#resultData").append(`<tr onclick="showProduct(${data[i][0]})" class="productSearch"><td><img class="searchImg" src='${data[i][4]}'></td>
                                         <td width="100%" style="text-align: left; padding-left: 1em">${data[i][1]}, ${data[i][3]} kr.</td>
                                         </tr>`);
            }
          } else { // no match
            $("#resultData").html("No match for: "+val);
          }
        })
      } else { // no input
        $("#resultData").css("display","none");
      }
    }
    </script>
  </body>
</html>
