<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Database search</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <style>
      .resultData {
        box-shadow: 5px 5px 5px lightgrey;
        border: 1px solid grey;
        border-radius: 0px 0px 5px 5px;
        padding: 1em;
        display: none;
        font-size: 18px;
        width: 45%;
        margin-left: 10em;
        position: absolute;
        background-color: white;
      }

      #searchImg {
        height: 60px;
      }

      .product {
        padding: 1em;
        border: 1px solid lightgrey;
      }

      .listImg {
        width: 12.5em;
        height: 12.5em;
      }

      .wrapper {
        width: 90%;
        margin: auto;
      }

      .product:hover {
        text-decoration: underline;
        color: blue;
        cursor: pointer;
        border-bottom: 3px solid black;
        transition: 0.5s;
      }

      #selectOrder {
        margin-top: 1em;
        margin-bottom: 1em;
      }
    </style>
  </head>
  <body onload="view(0)">
    <nav class="navbar navbar-dark navbar-expand bg-dark px-5">
      <!-- Links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="navbar-brand" href="index.php">Nettbutikk</a>
        </li>
      </ul>
      <div class="form-inline px-4" style="width: 45%">
        <input type="text" class="form-control" placeholder="Keyword" oninput="search(this.value)" id="inpSearch">
      </div>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="cart.php" id="lblHandlekurv"></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Login</a>
        </li>
      </ul>
    </nav>
    <table class="resultData" id="resultData"></table>

    <div class="wrapper">
      <select class="form-control" onchange="orderProducts()" id="selectOrder">
        <option>Order by price (low - high)</option>
        <option>Order by price (high - low)</option>
        <option>Order by name</option>
      </select>
      <table class="table" id="tblProducts">
      </table>
    </div>
    <script>
    function orderProducts() {
      const index = document.getElementById("selectOrder").selectedIndex;
      view(index);
    }

    function view(order) {

      $.get("/api/product/get", {order: order}, function(data) {
        console.log(data);

        $("#tblProducts").html(`<h4>Displaying ${data.length} products.</h4>`);
        for (var i = 0; i < data.length; i++) {
          const product = data[i];

          if((i % 5) === 0) {
            $("#tblProducts").append("</tr><tr>");
          }

          $("#tblProducts").append(`<td onclick="showProduct(${product[0]})" class="product"><img src='${product[4]}' class='listImg'><br>
                                      <h4>${product[1]}</h4> ${product[3]} kr<br></td>`);
        }
      })
    }

    function showProduct(id) {
      $("#tblProducts").css("display","none");

      $.get("/api/product/get/"+id, {}, function(data) {
        console.log(data);
      })
    }

    function search(val) {

      $("#resultData").html("");

      if (val != "" && val != " ") {
        $("#resultData").css("display","block");

        $.get("/api/product/search", {keyword: val}, function(data) {
          // search db
          console.log(data);

          if (data.length > 0) { // match
            for (var i = 0; i < data.length; i++) {
                $("#resultData").append(`<tr><td><img id="searchImg" src='${data[i][4]}'></td>
                                         <td>${data[i][1]}, ${data[i][3]} kr.<br>
                                         <i>${data[i][2]}</i></td>
                                         </tr>`);
            }
          } else { // no match
            $("#resultData").html("No match for: "+val);
          }
        })
      } else { // no input
        $("#resultData").css("display","none");
      }
    }
    </script>
  </body>
</html>
